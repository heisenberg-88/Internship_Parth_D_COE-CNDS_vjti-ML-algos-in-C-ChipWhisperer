   1              		.cpu cortex-m4
   2              		.eabi_attribute 20, 1
   3              		.eabi_attribute 21, 1
   4              		.eabi_attribute 23, 3
   5              		.eabi_attribute 24, 1
   6              		.eabi_attribute 25, 1
   7              		.eabi_attribute 26, 1
   8              		.eabi_attribute 30, 4
   9              		.eabi_attribute 34, 1
  10              		.eabi_attribute 18, 4
  11              		.file	"simpleserial.c"
  12              		.text
  13              	.Ltext0:
  14              		.cfi_sections	.debug_frame
  15              		.section	.text.check_version,"ax",%progbits
  16              		.align	1
  17              		.global	check_version
  18              		.arch armv7e-m
  19              		.syntax unified
  20              		.thumb
  21              		.thumb_func
  22              		.fpu softvfp
  24              	check_version:
  25              	.LVL0:
  26              	.LFB1:
  27              		.file 1 ".././simpleserial/simpleserial.c"
   1:.././simpleserial/simpleserial.c **** // simpleserial.c
   2:.././simpleserial/simpleserial.c **** 
   3:.././simpleserial/simpleserial.c **** #include "simpleserial.h"
   4:.././simpleserial/simpleserial.c **** #include <stdint.h>
   5:.././simpleserial/simpleserial.c **** #include "hal.h"
   6:.././simpleserial/simpleserial.c **** 
   7:.././simpleserial/simpleserial.c **** 
   8:.././simpleserial/simpleserial.c **** #define MAX_SS_CMDS 16
   9:.././simpleserial/simpleserial.c **** static int num_commands = 0;
  10:.././simpleserial/simpleserial.c **** 
  11:.././simpleserial/simpleserial.c **** #define MAX_SS_LEN 256
  12:.././simpleserial/simpleserial.c **** 
  13:.././simpleserial/simpleserial.c **** //#define SS_VER_1_0 0
  14:.././simpleserial/simpleserial.c **** //#define SS_VER_1_1 1
  15:.././simpleserial/simpleserial.c **** //#define SS_VER_2_0 2
  16:.././simpleserial/simpleserial.c **** 
  17:.././simpleserial/simpleserial.c **** 
  18:.././simpleserial/simpleserial.c **** // 0xA6 formerly 
  19:.././simpleserial/simpleserial.c **** #define CW_CRC 0x4D 
  20:.././simpleserial/simpleserial.c **** uint8_t ss_crc(uint8_t *buf, uint8_t len)
  21:.././simpleserial/simpleserial.c **** {
  22:.././simpleserial/simpleserial.c **** 	unsigned int k = 0;
  23:.././simpleserial/simpleserial.c **** 	uint8_t crc = 0x00;
  24:.././simpleserial/simpleserial.c **** 	while (len--) {
  25:.././simpleserial/simpleserial.c **** 		crc ^= *buf++;
  26:.././simpleserial/simpleserial.c **** 		for (k = 0; k < 8; k++) {
  27:.././simpleserial/simpleserial.c **** 			crc = crc & 0x80 ? (crc << 1) ^ CW_CRC: crc << 1;
  28:.././simpleserial/simpleserial.c **** 		}
  29:.././simpleserial/simpleserial.c **** 	}
  30:.././simpleserial/simpleserial.c **** 	return crc;
  31:.././simpleserial/simpleserial.c **** 
  32:.././simpleserial/simpleserial.c **** }
  33:.././simpleserial/simpleserial.c **** 
  34:.././simpleserial/simpleserial.c **** // [B_STUFF, CMD, SCMD, LEN, B_STUFF, DATA..., CRC, TERM]
  35:.././simpleserial/simpleserial.c **** 
  36:.././simpleserial/simpleserial.c **** //#define SS_VER SS_VER_2_0
  37:.././simpleserial/simpleserial.c **** #if SS_VER == SS_VER_2_0
  38:.././simpleserial/simpleserial.c **** #error "SS_VER_2_0 is deprecated! Use SS_VER_2_1 instead."
  39:.././simpleserial/simpleserial.c **** #elif SS_VER == SS_VER_2_1
  40:.././simpleserial/simpleserial.c **** 
  41:.././simpleserial/simpleserial.c **** 
  42:.././simpleserial/simpleserial.c **** typedef struct ss_cmd
  43:.././simpleserial/simpleserial.c **** {
  44:.././simpleserial/simpleserial.c **** 	char c;
  45:.././simpleserial/simpleserial.c **** 	unsigned int len;
  46:.././simpleserial/simpleserial.c **** 	uint8_t (*fp)(uint8_t, uint8_t, uint8_t, uint8_t *);
  47:.././simpleserial/simpleserial.c **** } ss_cmd;
  48:.././simpleserial/simpleserial.c **** static ss_cmd commands[MAX_SS_CMDS];
  49:.././simpleserial/simpleserial.c **** 
  50:.././simpleserial/simpleserial.c **** void ss_puts(char *x)
  51:.././simpleserial/simpleserial.c **** {
  52:.././simpleserial/simpleserial.c **** 	do {
  53:.././simpleserial/simpleserial.c **** 		putch(*x);
  54:.././simpleserial/simpleserial.c **** 	} while (*++x);
  55:.././simpleserial/simpleserial.c **** }
  56:.././simpleserial/simpleserial.c **** 
  57:.././simpleserial/simpleserial.c **** #define FRAME_BYTE 0x00
  58:.././simpleserial/simpleserial.c **** 
  59:.././simpleserial/simpleserial.c **** uint8_t check_version(uint8_t cmd, uint8_t scmd, uint8_t len, uint8_t *data)
  60:.././simpleserial/simpleserial.c **** {
  61:.././simpleserial/simpleserial.c **** 	uint8_t ver = SS_VER;
  62:.././simpleserial/simpleserial.c **** 	simpleserial_put('r', 1, &ver);
  63:.././simpleserial/simpleserial.c **** 	return SS_ERR_OK;
  64:.././simpleserial/simpleserial.c **** }
  65:.././simpleserial/simpleserial.c **** 
  66:.././simpleserial/simpleserial.c **** uint8_t ss_get_commands(uint8_t cmd, uint8_t scmd, uint8_t len, uint8_t *data)
  67:.././simpleserial/simpleserial.c **** {
  68:.././simpleserial/simpleserial.c ****     uint8_t cmd_chars[MAX_SS_CMDS];
  69:.././simpleserial/simpleserial.c ****     for (uint8_t i = 0; i < (num_commands & 0xFF); i++) {
  70:.././simpleserial/simpleserial.c ****         cmd_chars[i] = commands[i].c;
  71:.././simpleserial/simpleserial.c ****     }
  72:.././simpleserial/simpleserial.c **** 
  73:.././simpleserial/simpleserial.c ****     simpleserial_put('r', num_commands & 0xFF, (void *)cmd_chars);
  74:.././simpleserial/simpleserial.c ****     return 0x00;
  75:.././simpleserial/simpleserial.c **** 
  76:.././simpleserial/simpleserial.c **** }
  77:.././simpleserial/simpleserial.c **** 
  78:.././simpleserial/simpleserial.c **** uint8_t stuff_data(uint8_t *buf, uint8_t len)
  79:.././simpleserial/simpleserial.c **** {
  80:.././simpleserial/simpleserial.c **** 	uint8_t i = 1;
  81:.././simpleserial/simpleserial.c **** 	uint8_t last = 0;
  82:.././simpleserial/simpleserial.c **** 	for (; i < len; i++) {
  83:.././simpleserial/simpleserial.c **** 		if (buf[i] == FRAME_BYTE) {
  84:.././simpleserial/simpleserial.c **** 			buf[last] = i - last;
  85:.././simpleserial/simpleserial.c **** 			last = i;
  86:.././simpleserial/simpleserial.c **** 		}
  87:.././simpleserial/simpleserial.c **** 	}
  88:.././simpleserial/simpleserial.c **** 	return 0x00;
  89:.././simpleserial/simpleserial.c **** }
  90:.././simpleserial/simpleserial.c **** 
  91:.././simpleserial/simpleserial.c **** uint8_t unstuff_data(uint8_t *buf, uint8_t len)
  92:.././simpleserial/simpleserial.c **** {
  93:.././simpleserial/simpleserial.c **** 	uint8_t next = buf[0];
  94:.././simpleserial/simpleserial.c **** 	buf[0] = 0x00;
  95:.././simpleserial/simpleserial.c **** 	//len -= 1;
  96:.././simpleserial/simpleserial.c **** 	uint8_t tmp = next;
  97:.././simpleserial/simpleserial.c **** 	while ((next < len) && tmp != 0) {
  98:.././simpleserial/simpleserial.c **** 		tmp = buf[next];
  99:.././simpleserial/simpleserial.c **** 		buf[next] = FRAME_BYTE;
 100:.././simpleserial/simpleserial.c **** 		next += tmp;
 101:.././simpleserial/simpleserial.c **** 	}
 102:.././simpleserial/simpleserial.c **** 	return next;
 103:.././simpleserial/simpleserial.c **** }
 104:.././simpleserial/simpleserial.c **** 
 105:.././simpleserial/simpleserial.c **** // Set up the SimpleSerial module by preparing internal commands
 106:.././simpleserial/simpleserial.c **** // This just adds the "v" command for now...
 107:.././simpleserial/simpleserial.c **** void simpleserial_init()
 108:.././simpleserial/simpleserial.c **** {
 109:.././simpleserial/simpleserial.c **** 	simpleserial_addcmd('v', 0, check_version);
 110:.././simpleserial/simpleserial.c ****     simpleserial_addcmd('w', 0, ss_get_commands);
 111:.././simpleserial/simpleserial.c **** }
 112:.././simpleserial/simpleserial.c **** 
 113:.././simpleserial/simpleserial.c **** int simpleserial_addcmd(char c, unsigned int len, uint8_t (*fp)(uint8_t, uint8_t, uint8_t, uint8_t*
 114:.././simpleserial/simpleserial.c **** {
 115:.././simpleserial/simpleserial.c **** 	if(num_commands >= MAX_SS_CMDS) {
 116:.././simpleserial/simpleserial.c **** 		putch('a');
 117:.././simpleserial/simpleserial.c **** 		return 1;
 118:.././simpleserial/simpleserial.c **** 	}
 119:.././simpleserial/simpleserial.c **** 
 120:.././simpleserial/simpleserial.c **** 	if(len >= MAX_SS_LEN) {
 121:.././simpleserial/simpleserial.c **** 		putch('b');
 122:.././simpleserial/simpleserial.c **** 		return 1;
 123:.././simpleserial/simpleserial.c **** 	}
 124:.././simpleserial/simpleserial.c **** 
 125:.././simpleserial/simpleserial.c **** 	commands[num_commands].c   = c;
 126:.././simpleserial/simpleserial.c **** 	commands[num_commands].len = len;
 127:.././simpleserial/simpleserial.c **** 	commands[num_commands].fp  = fp;
 128:.././simpleserial/simpleserial.c **** 	num_commands++;
 129:.././simpleserial/simpleserial.c **** 
 130:.././simpleserial/simpleserial.c **** 	return 0;
 131:.././simpleserial/simpleserial.c **** }
 132:.././simpleserial/simpleserial.c **** 
 133:.././simpleserial/simpleserial.c **** void simpleserial_get(void)
 134:.././simpleserial/simpleserial.c **** {
 135:.././simpleserial/simpleserial.c **** 	uint8_t data_buf[MAX_SS_LEN];
 136:.././simpleserial/simpleserial.c **** 	uint8_t err = 0;
 137:.././simpleserial/simpleserial.c **** 
 138:.././simpleserial/simpleserial.c **** 	for (int i = 0; i < 4; i++) {
 139:.././simpleserial/simpleserial.c **** 		data_buf[i] = getch(); //PTR, cmd, scmd, len
 140:.././simpleserial/simpleserial.c **** 		if (data_buf[i] == FRAME_BYTE) {
 141:.././simpleserial/simpleserial.c **** 			err = SS_ERR_FRAME_BYTE;
 142:.././simpleserial/simpleserial.c **** 			goto ERROR;
 143:.././simpleserial/simpleserial.c **** 		}
 144:.././simpleserial/simpleserial.c **** 	}
 145:.././simpleserial/simpleserial.c **** 	uint8_t next_frame = unstuff_data(data_buf, 4);
 146:.././simpleserial/simpleserial.c **** 
 147:.././simpleserial/simpleserial.c **** 	// check for valid command
 148:.././simpleserial/simpleserial.c **** 	uint8_t c = 0;
 149:.././simpleserial/simpleserial.c **** 	for(c = 0; c < num_commands; c++)
 150:.././simpleserial/simpleserial.c **** 	{
 151:.././simpleserial/simpleserial.c **** 		if(commands[c].c == data_buf[1])
 152:.././simpleserial/simpleserial.c **** 			break;
 153:.././simpleserial/simpleserial.c **** 	}
 154:.././simpleserial/simpleserial.c **** 
 155:.././simpleserial/simpleserial.c **** 	if (c == num_commands) {
 156:.././simpleserial/simpleserial.c **** 		err = SS_ERR_CMD;
 157:.././simpleserial/simpleserial.c **** 		goto ERROR;
 158:.././simpleserial/simpleserial.c **** 	}
 159:.././simpleserial/simpleserial.c **** 
 160:.././simpleserial/simpleserial.c **** 	//check that next frame not beyond end of message
 161:.././simpleserial/simpleserial.c **** 	// account for cmd, scmd, len, data, crc, end of frame
 162:.././simpleserial/simpleserial.c **** 	if ((data_buf[3] + 5) < next_frame) {
 163:.././simpleserial/simpleserial.c **** 		err = SS_ERR_LEN;
 164:.././simpleserial/simpleserial.c **** 		goto ERROR;
 165:.././simpleserial/simpleserial.c **** 	}
 166:.././simpleserial/simpleserial.c **** 
 167:.././simpleserial/simpleserial.c **** 	// read in data
 168:.././simpleserial/simpleserial.c **** 	// eq to len + crc + frame end
 169:.././simpleserial/simpleserial.c **** 	int i = 4;
 170:.././simpleserial/simpleserial.c **** 	for (; i < data_buf[3] + 5; i++) {
 171:.././simpleserial/simpleserial.c **** 		data_buf[i] = getch();
 172:.././simpleserial/simpleserial.c **** 		if (data_buf[i] == FRAME_BYTE) {
 173:.././simpleserial/simpleserial.c **** 			err = SS_ERR_FRAME_BYTE;
 174:.././simpleserial/simpleserial.c **** 			goto ERROR;
 175:.././simpleserial/simpleserial.c **** 		}
 176:.././simpleserial/simpleserial.c **** 	}
 177:.././simpleserial/simpleserial.c **** 
 178:.././simpleserial/simpleserial.c **** 	//check that final byte is the FRAME_BYTE
 179:.././simpleserial/simpleserial.c **** 	data_buf[i] = getch();
 180:.././simpleserial/simpleserial.c **** 	if (data_buf[i] != FRAME_BYTE) {
 181:.././simpleserial/simpleserial.c **** 		err = SS_ERR_LEN;
 182:.././simpleserial/simpleserial.c **** 		goto ERROR;
 183:.././simpleserial/simpleserial.c **** 	}
 184:.././simpleserial/simpleserial.c **** 
 185:.././simpleserial/simpleserial.c **** 	//fully unstuff data now
 186:.././simpleserial/simpleserial.c **** 	unstuff_data(data_buf + next_frame, i - next_frame + 1);
 187:.././simpleserial/simpleserial.c **** 
 188:.././simpleserial/simpleserial.c **** 	//calc crc excluding original frame offset and frame end and crc
 189:.././simpleserial/simpleserial.c **** 	uint8_t crc = ss_crc(data_buf+1, i-2);
 190:.././simpleserial/simpleserial.c **** 	if (crc != data_buf[i-1]) {
 191:.././simpleserial/simpleserial.c **** 		err = SS_ERR_CRC;
 192:.././simpleserial/simpleserial.c **** 		goto ERROR;
 193:.././simpleserial/simpleserial.c **** 	}
 194:.././simpleserial/simpleserial.c **** 
 195:.././simpleserial/simpleserial.c **** 	err = commands[c].fp(data_buf[1], data_buf[2], data_buf[3], data_buf+4);
 196:.././simpleserial/simpleserial.c **** 
 197:.././simpleserial/simpleserial.c **** ERROR:
 198:.././simpleserial/simpleserial.c **** 	simpleserial_put('e', 0x01, &err);
 199:.././simpleserial/simpleserial.c **** 	return;
 200:.././simpleserial/simpleserial.c **** }
 201:.././simpleserial/simpleserial.c **** 
 202:.././simpleserial/simpleserial.c **** void simpleserial_put(char c, uint8_t size, uint8_t* output)
 203:.././simpleserial/simpleserial.c **** {
 204:.././simpleserial/simpleserial.c **** 	uint8_t data_buf[MAX_SS_LEN];
 205:.././simpleserial/simpleserial.c **** 	data_buf[0] = 0x00;
 206:.././simpleserial/simpleserial.c **** 	data_buf[1] = c;
 207:.././simpleserial/simpleserial.c **** 	data_buf[2] = size;
 208:.././simpleserial/simpleserial.c **** 	int i = 0;
 209:.././simpleserial/simpleserial.c **** 	for (; i < size; i++) {
 210:.././simpleserial/simpleserial.c **** 		data_buf[i + 3] = output[i];
 211:.././simpleserial/simpleserial.c **** 	}
 212:.././simpleserial/simpleserial.c **** 	data_buf[i + 3] = ss_crc(data_buf+1, size+2);
 213:.././simpleserial/simpleserial.c **** 	data_buf[i + 4] = 0x00;
 214:.././simpleserial/simpleserial.c **** 	stuff_data(data_buf, i + 5);
 215:.././simpleserial/simpleserial.c **** 	for (int i = 0; i < size + 5; i++) {
 216:.././simpleserial/simpleserial.c **** 		putch(data_buf[i]);
 217:.././simpleserial/simpleserial.c **** 	}
 218:.././simpleserial/simpleserial.c **** }
 219:.././simpleserial/simpleserial.c **** 
 220:.././simpleserial/simpleserial.c **** 
 221:.././simpleserial/simpleserial.c **** #else
 222:.././simpleserial/simpleserial.c **** 
 223:.././simpleserial/simpleserial.c **** typedef struct ss_cmd
 224:.././simpleserial/simpleserial.c **** {
 225:.././simpleserial/simpleserial.c **** 	char c;
 226:.././simpleserial/simpleserial.c **** 	unsigned int len;
 227:.././simpleserial/simpleserial.c **** 	uint8_t (*fp)(uint8_t*, uint8_t);
 228:.././simpleserial/simpleserial.c **** 	uint8_t flags;
 229:.././simpleserial/simpleserial.c **** } ss_cmd;
 230:.././simpleserial/simpleserial.c **** static ss_cmd commands[MAX_SS_CMDS];
 231:.././simpleserial/simpleserial.c **** // Callback function for "v" command.
 232:.././simpleserial/simpleserial.c **** // This can exist in v1.0 as long as we don't actually send back an ack ("z")
 233:.././simpleserial/simpleserial.c **** uint8_t check_version(uint8_t *v, uint8_t len)
 234:.././simpleserial/simpleserial.c **** {
  28              		.loc 1 234 1 view -0
  29              		.cfi_startproc
  30              		@ args = 0, pretend = 0, frame = 0
  31              		@ frame_needed = 0, uses_anonymous_args = 0
  32              		@ link register save eliminated.
 235:.././simpleserial/simpleserial.c **** 	return SS_VER;
  33              		.loc 1 235 2 view .LVU1
 236:.././simpleserial/simpleserial.c **** }
  34              		.loc 1 236 1 is_stmt 0 view .LVU2
  35 0000 0120     		movs	r0, #1
  36              	.LVL1:
  37              		.loc 1 236 1 view .LVU3
  38 0002 7047     		bx	lr
  39              		.cfi_endproc
  40              	.LFE1:
  42              		.section	.text.ss_crc,"ax",%progbits
  43              		.align	1
  44              		.global	ss_crc
  45              		.syntax unified
  46              		.thumb
  47              		.thumb_func
  48              		.fpu softvfp
  50              	ss_crc:
  51              	.LVL2:
  52              	.LFB0:
  21:.././simpleserial/simpleserial.c **** 	unsigned int k = 0;
  53              		.loc 1 21 1 is_stmt 1 view -0
  54              		.cfi_startproc
  55              		@ args = 0, pretend = 0, frame = 0
  56              		@ frame_needed = 0, uses_anonymous_args = 0
  57              		@ link register save eliminated.
  21:.././simpleserial/simpleserial.c **** 	unsigned int k = 0;
  58              		.loc 1 21 1 is_stmt 0 view .LVU5
  59 0000 0346     		mov	r3, r0
  22:.././simpleserial/simpleserial.c **** 	uint8_t crc = 0x00;
  60              		.loc 1 22 2 is_stmt 1 view .LVU6
  61              	.LVL3:
  23:.././simpleserial/simpleserial.c **** 	while (len--) {
  62              		.loc 1 23 2 view .LVU7
  24:.././simpleserial/simpleserial.c **** 		crc ^= *buf++;
  63              		.loc 1 24 2 view .LVU8
  64 0002 0144     		add	r1, r1, r0
  65              	.LVL4:
  23:.././simpleserial/simpleserial.c **** 	while (len--) {
  66              		.loc 1 23 10 is_stmt 0 view .LVU9
  67 0004 0020     		movs	r0, #0
  68              	.LVL5:
  69              	.L3:
  24:.././simpleserial/simpleserial.c **** 		crc ^= *buf++;
  70              		.loc 1 24 8 is_stmt 1 view .LVU10
  24:.././simpleserial/simpleserial.c **** 		crc ^= *buf++;
  71              		.loc 1 24 8 is_stmt 0 view .LVU11
  72 0006 8B42     		cmp	r3, r1
  73 0008 00D1     		bne	.L7
  30:.././simpleserial/simpleserial.c **** 
  74              		.loc 1 30 2 is_stmt 1 view .LVU12
  32:.././simpleserial/simpleserial.c **** 
  75              		.loc 1 32 1 is_stmt 0 view .LVU13
  76 000a 7047     		bx	lr
  77              	.L7:
  25:.././simpleserial/simpleserial.c **** 		for (k = 0; k < 8; k++) {
  78              		.loc 1 25 3 is_stmt 1 view .LVU14
  79              	.LVL6:
  25:.././simpleserial/simpleserial.c **** 		for (k = 0; k < 8; k++) {
  80              		.loc 1 25 7 is_stmt 0 view .LVU15
  81 000c 13F8012B 		ldrb	r2, [r3], #1	@ zero_extendqisi2
  82              	.LVL7:
  25:.././simpleserial/simpleserial.c **** 		for (k = 0; k < 8; k++) {
  83              		.loc 1 25 7 view .LVU16
  84 0010 5040     		eors	r0, r0, r2
  85              	.LVL8:
  26:.././simpleserial/simpleserial.c **** 			crc = crc & 0x80 ? (crc << 1) ^ CW_CRC: crc << 1;
  86              		.loc 1 26 3 is_stmt 1 view .LVU17
  26:.././simpleserial/simpleserial.c **** 			crc = crc & 0x80 ? (crc << 1) ^ CW_CRC: crc << 1;
  87              		.loc 1 26 15 view .LVU18
  25:.././simpleserial/simpleserial.c **** 		for (k = 0; k < 8; k++) {
  88              		.loc 1 25 7 is_stmt 0 view .LVU19
  89 0012 0822     		movs	r2, #8
  90              	.LVL9:
  91              	.L6:
  27:.././simpleserial/simpleserial.c **** 		}
  92              		.loc 1 27 4 is_stmt 1 view .LVU20
  27:.././simpleserial/simpleserial.c **** 		}
  93              		.loc 1 27 8 is_stmt 0 view .LVU21
  94 0014 10F0800F 		tst	r0, #128
  95 0018 4FEA4000 		lsl	r0, r0, #1
  96              	.LVL10:
  27:.././simpleserial/simpleserial.c **** 		}
  97              		.loc 1 27 34 view .LVU22
  98 001c 18BF     		it	ne
  99 001e 80F04D00 		eorne	r0, r0, #77
  26:.././simpleserial/simpleserial.c **** 			crc = crc & 0x80 ? (crc << 1) ^ CW_CRC: crc << 1;
 100              		.loc 1 26 3 view .LVU23
 101 0022 013A     		subs	r2, r2, #1
 102              	.LVL11:
  27:.././simpleserial/simpleserial.c **** 		}
 103              		.loc 1 27 8 view .LVU24
 104 0024 C0B2     		uxtb	r0, r0
 105              	.LVL12:
  26:.././simpleserial/simpleserial.c **** 			crc = crc & 0x80 ? (crc << 1) ^ CW_CRC: crc << 1;
 106              		.loc 1 26 22 is_stmt 1 view .LVU25
  26:.././simpleserial/simpleserial.c **** 			crc = crc & 0x80 ? (crc << 1) ^ CW_CRC: crc << 1;
 107              		.loc 1 26 15 view .LVU26
  26:.././simpleserial/simpleserial.c **** 			crc = crc & 0x80 ? (crc << 1) ^ CW_CRC: crc << 1;
 108              		.loc 1 26 3 is_stmt 0 view .LVU27
 109 0026 F5D1     		bne	.L6
 110 0028 EDE7     		b	.L3
 111              		.cfi_endproc
 112              	.LFE0:
 114              		.section	.text.hex_decode,"ax",%progbits
 115              		.align	1
 116              		.global	hex_decode
 117              		.syntax unified
 118              		.thumb
 119              		.thumb_func
 120              		.fpu softvfp
 122              	hex_decode:
 123              	.LVL13:
 124              	.LFB4:
 237:.././simpleserial/simpleserial.c **** 
 238:.././simpleserial/simpleserial.c **** uint8_t ss_num_commands(uint8_t *x, uint8_t len)
 239:.././simpleserial/simpleserial.c **** {
 240:.././simpleserial/simpleserial.c ****     uint8_t ncmds = num_commands & 0xFF;
 241:.././simpleserial/simpleserial.c ****     simpleserial_put('r', 0x01, &ncmds);
 242:.././simpleserial/simpleserial.c ****     return 0x00;
 243:.././simpleserial/simpleserial.c **** }
 244:.././simpleserial/simpleserial.c **** 
 245:.././simpleserial/simpleserial.c **** typedef struct ss_cmd_repr {
 246:.././simpleserial/simpleserial.c ****     uint8_t c;
 247:.././simpleserial/simpleserial.c ****     uint8_t len;
 248:.././simpleserial/simpleserial.c ****     uint8_t flags;
 249:.././simpleserial/simpleserial.c **** } ss_cmd_repr;
 250:.././simpleserial/simpleserial.c **** 
 251:.././simpleserial/simpleserial.c **** uint8_t ss_get_commands(uint8_t *x, uint8_t len)
 252:.././simpleserial/simpleserial.c **** {
 253:.././simpleserial/simpleserial.c ****     ss_cmd_repr repr_cmd_buf[MAX_SS_CMDS];
 254:.././simpleserial/simpleserial.c ****     for (uint8_t i = 0; i < (num_commands & 0xFF); i++) {
 255:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].c = commands[i].c;
 256:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].len = commands[i].len;
 257:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].flags = commands[i].flags;
 258:.././simpleserial/simpleserial.c ****     }
 259:.././simpleserial/simpleserial.c **** 
 260:.././simpleserial/simpleserial.c ****     simpleserial_put('r', num_commands * 0x03, (void *) repr_cmd_buf);
 261:.././simpleserial/simpleserial.c ****     return 0x00;
 262:.././simpleserial/simpleserial.c **** }
 263:.././simpleserial/simpleserial.c **** 
 264:.././simpleserial/simpleserial.c **** static char hex_lookup[16] =
 265:.././simpleserial/simpleserial.c **** {
 266:.././simpleserial/simpleserial.c **** 	'0', '1', '2', '3', '4', '5', '6', '7',
 267:.././simpleserial/simpleserial.c **** 	'8', '9', 'A', 'B', 'C', 'D', 'E', 'F'
 268:.././simpleserial/simpleserial.c **** };
 269:.././simpleserial/simpleserial.c **** 
 270:.././simpleserial/simpleserial.c **** int hex_decode(int len, char* ascii_buf, uint8_t* data_buf)
 271:.././simpleserial/simpleserial.c **** {
 125              		.loc 1 271 1 is_stmt 1 view -0
 126              		.cfi_startproc
 127              		@ args = 0, pretend = 0, frame = 0
 128              		@ frame_needed = 0, uses_anonymous_args = 0
 272:.././simpleserial/simpleserial.c **** 	for(int i = 0; i < len; i++)
 129              		.loc 1 272 2 view .LVU29
 130              	.LBB2:
 131              		.loc 1 272 6 view .LVU30
 132              		.loc 1 272 6 is_stmt 0 view .LVU31
 133              	.LBE2:
 271:.././simpleserial/simpleserial.c **** 	for(int i = 0; i < len; i++)
 134              		.loc 1 271 1 view .LVU32
 135 0000 F0B5     		push	{r4, r5, r6, r7, lr}
 136              	.LCFI0:
 137              		.cfi_def_cfa_offset 20
 138              		.cfi_offset 4, -20
 139              		.cfi_offset 5, -16
 140              		.cfi_offset 6, -12
 141              		.cfi_offset 7, -8
 142              		.cfi_offset 14, -4
 143              	.LBB7:
 144              		.loc 1 272 10 view .LVU33
 145 0002 0025     		movs	r5, #0
 146              	.LBB3:
 273:.././simpleserial/simpleserial.c **** 	{
 274:.././simpleserial/simpleserial.c **** 		char n_hi = ascii_buf[2*i];
 275:.././simpleserial/simpleserial.c **** 		char n_lo = ascii_buf[2*i+1];
 147              		.loc 1 275 8 view .LVU34
 148 0004 4F1C     		adds	r7, r1, #1
 149              	.LVL14:
 150              	.L10:
 151              		.loc 1 275 8 view .LVU35
 152              	.LBE3:
 272:.././simpleserial/simpleserial.c **** 	{
 153              		.loc 1 272 17 is_stmt 1 discriminator 1 view .LVU36
 272:.././simpleserial/simpleserial.c **** 	{
 154              		.loc 1 272 2 is_stmt 0 discriminator 1 view .LVU37
 155 0006 8542     		cmp	r5, r0
 156 0008 01DB     		blt	.L20
 157              	.LBE7:
 276:.././simpleserial/simpleserial.c **** 
 277:.././simpleserial/simpleserial.c **** 		if(n_lo >= '0' && n_lo <= '9')
 278:.././simpleserial/simpleserial.c **** 			data_buf[i] = n_lo - '0';
 279:.././simpleserial/simpleserial.c **** 		else if(n_lo >= 'A' && n_lo <= 'F')
 280:.././simpleserial/simpleserial.c **** 			data_buf[i] = n_lo - 'A' + 10;
 281:.././simpleserial/simpleserial.c **** 		else if(n_lo >= 'a' && n_lo <= 'f')
 282:.././simpleserial/simpleserial.c **** 			data_buf[i] = n_lo - 'a' + 10;
 283:.././simpleserial/simpleserial.c **** 		else
 284:.././simpleserial/simpleserial.c **** 			return 1;
 285:.././simpleserial/simpleserial.c **** 
 286:.././simpleserial/simpleserial.c **** 		if(n_hi >= '0' && n_hi <= '9')
 287:.././simpleserial/simpleserial.c **** 			data_buf[i] |= (n_hi - '0') << 4;
 288:.././simpleserial/simpleserial.c **** 		else if(n_hi >= 'A' && n_hi <= 'F')
 289:.././simpleserial/simpleserial.c **** 			data_buf[i] |= (n_hi - 'A' + 10) << 4;
 290:.././simpleserial/simpleserial.c **** 		else if(n_hi >= 'a' && n_hi <= 'f')
 291:.././simpleserial/simpleserial.c **** 			data_buf[i] |= (n_hi - 'a' + 10) << 4;
 292:.././simpleserial/simpleserial.c **** 		else
 293:.././simpleserial/simpleserial.c **** 			return 1;
 294:.././simpleserial/simpleserial.c **** 	}
 295:.././simpleserial/simpleserial.c **** 
 296:.././simpleserial/simpleserial.c **** 	return 0;
 158              		.loc 1 296 9 view .LVU38
 159 000a 0020     		movs	r0, #0
 160              	.LVL15:
 161              		.loc 1 296 9 view .LVU39
 162 000c 21E0     		b	.L9
 163              	.LVL16:
 164              	.L20:
 165              	.LBB8:
 166              	.LBB4:
 274:.././simpleserial/simpleserial.c **** 		char n_lo = ascii_buf[2*i+1];
 167              		.loc 1 274 3 is_stmt 1 view .LVU40
 275:.././simpleserial/simpleserial.c **** 
 168              		.loc 1 275 8 is_stmt 0 view .LVU41
 169 000e 17F81540 		ldrb	r4, [r7, r5, lsl #1]	@ zero_extendqisi2
 274:.././simpleserial/simpleserial.c **** 		char n_lo = ascii_buf[2*i+1];
 170              		.loc 1 274 8 view .LVU42
 171 0012 11F81530 		ldrb	r3, [r1, r5, lsl #1]	@ zero_extendqisi2
 172              	.LVL17:
 275:.././simpleserial/simpleserial.c **** 
 173              		.loc 1 275 3 is_stmt 1 view .LVU43
 277:.././simpleserial/simpleserial.c **** 			data_buf[i] = n_lo - '0';
 174              		.loc 1 277 3 view .LVU44
 277:.././simpleserial/simpleserial.c **** 			data_buf[i] = n_lo - '0';
 175              		.loc 1 277 18 is_stmt 0 view .LVU45
 176 0016 A4F13006 		sub	r6, r4, #48
 177 001a F6B2     		uxtb	r6, r6
 277:.././simpleserial/simpleserial.c **** 			data_buf[i] = n_lo - '0';
 178              		.loc 1 277 5 view .LVU46
 179 001c 092E     		cmp	r6, #9
 180 001e 0CD8     		bhi	.L11
 278:.././simpleserial/simpleserial.c **** 		else if(n_lo >= 'A' && n_lo <= 'F')
 181              		.loc 1 278 4 is_stmt 1 view .LVU47
 278:.././simpleserial/simpleserial.c **** 		else if(n_lo >= 'A' && n_lo <= 'F')
 182              		.loc 1 278 16 is_stmt 0 view .LVU48
 183 0020 1670     		strb	r6, [r2]
 184              	.LVL18:
 185              	.L12:
 286:.././simpleserial/simpleserial.c **** 			data_buf[i] |= (n_hi - '0') << 4;
 186              		.loc 1 286 3 is_stmt 1 view .LVU49
 286:.././simpleserial/simpleserial.c **** 			data_buf[i] |= (n_hi - '0') << 4;
 187              		.loc 1 286 18 is_stmt 0 view .LVU50
 188 0022 A3F13004 		sub	r4, r3, #48
 286:.././simpleserial/simpleserial.c **** 			data_buf[i] |= (n_hi - '0') << 4;
 189              		.loc 1 286 5 view .LVU51
 190 0026 E6B2     		uxtb	r6, r4
 191 0028 092E     		cmp	r6, #9
 192 002a 15D8     		bhi	.L16
 193              	.L23:
 289:.././simpleserial/simpleserial.c **** 		else if(n_hi >= 'a' && n_hi <= 'f')
 194              		.loc 1 289 16 view .LVU52
 195 002c 1378     		ldrb	r3, [r2]	@ zero_extendqisi2
 196              	.LVL19:
 289:.././simpleserial/simpleserial.c **** 		else if(n_hi >= 'a' && n_hi <= 'f')
 197              		.loc 1 289 16 view .LVU53
 198 002e 43EA0413 		orr	r3, r3, r4, lsl #4
 199              	.L22:
 291:.././simpleserial/simpleserial.c **** 		else
 200              		.loc 1 291 16 view .LVU54
 201 0032 1370     		strb	r3, [r2]
 202              	.LBE4:
 272:.././simpleserial/simpleserial.c **** 	{
 203              		.loc 1 272 26 is_stmt 1 view .LVU55
 272:.././simpleserial/simpleserial.c **** 	{
 204              		.loc 1 272 27 is_stmt 0 view .LVU56
 205 0034 0135     		adds	r5, r5, #1
 206              	.LVL20:
 272:.././simpleserial/simpleserial.c **** 	{
 207              		.loc 1 272 27 view .LVU57
 208 0036 0132     		adds	r2, r2, #1
 209 0038 E5E7     		b	.L10
 210              	.LVL21:
 211              	.L11:
 212              	.LBB5:
 279:.././simpleserial/simpleserial.c **** 			data_buf[i] = n_lo - 'A' + 10;
 213              		.loc 1 279 8 is_stmt 1 view .LVU58
 279:.././simpleserial/simpleserial.c **** 			data_buf[i] = n_lo - 'A' + 10;
 214              		.loc 1 279 10 is_stmt 0 view .LVU59
 215 003a A4F14106 		sub	r6, r4, #65
 216 003e 052E     		cmp	r6, #5
 217 0040 02D8     		bhi	.L13
 280:.././simpleserial/simpleserial.c **** 		else if(n_lo >= 'a' && n_lo <= 'f')
 218              		.loc 1 280 4 is_stmt 1 view .LVU60
 280:.././simpleserial/simpleserial.c **** 		else if(n_lo >= 'a' && n_lo <= 'f')
 219              		.loc 1 280 29 is_stmt 0 view .LVU61
 220 0042 373C     		subs	r4, r4, #55
 221              	.LVL22:
 222              	.L21:
 282:.././simpleserial/simpleserial.c **** 		else
 223              		.loc 1 282 16 view .LVU62
 224 0044 1470     		strb	r4, [r2]
 225              	.LVL23:
 282:.././simpleserial/simpleserial.c **** 		else
 226              		.loc 1 282 16 view .LVU63
 227 0046 ECE7     		b	.L12
 228              	.LVL24:
 229              	.L13:
 281:.././simpleserial/simpleserial.c **** 			data_buf[i] = n_lo - 'a' + 10;
 230              		.loc 1 281 8 is_stmt 1 view .LVU64
 281:.././simpleserial/simpleserial.c **** 			data_buf[i] = n_lo - 'a' + 10;
 231              		.loc 1 281 10 is_stmt 0 view .LVU65
 232 0048 A4F16106 		sub	r6, r4, #97
 233 004c 052E     		cmp	r6, #5
 234 004e 01D9     		bls	.L14
 235              	.LVL25:
 236              	.L19:
 284:.././simpleserial/simpleserial.c **** 
 237              		.loc 1 284 11 view .LVU66
 238 0050 0120     		movs	r0, #1
 239              	.LVL26:
 240              	.L9:
 284:.././simpleserial/simpleserial.c **** 
 241              		.loc 1 284 11 view .LVU67
 242              	.LBE5:
 243              	.LBE8:
 297:.././simpleserial/simpleserial.c **** }
 244              		.loc 1 297 1 view .LVU68
 245 0052 F0BD     		pop	{r4, r5, r6, r7, pc}
 246              	.LVL27:
 247              	.L14:
 248              	.LBB9:
 249              	.LBB6:
 282:.././simpleserial/simpleserial.c **** 		else
 250              		.loc 1 282 4 is_stmt 1 view .LVU69
 282:.././simpleserial/simpleserial.c **** 		else
 251              		.loc 1 282 29 is_stmt 0 view .LVU70
 252 0054 573C     		subs	r4, r4, #87
 253              	.LVL28:
 282:.././simpleserial/simpleserial.c **** 		else
 254              		.loc 1 282 29 view .LVU71
 255 0056 F5E7     		b	.L21
 256              	.LVL29:
 257              	.L16:
 288:.././simpleserial/simpleserial.c **** 			data_buf[i] |= (n_hi - 'A' + 10) << 4;
 258              		.loc 1 288 8 is_stmt 1 view .LVU72
 288:.././simpleserial/simpleserial.c **** 			data_buf[i] |= (n_hi - 'A' + 10) << 4;
 259              		.loc 1 288 10 is_stmt 0 view .LVU73
 260 0058 A3F14104 		sub	r4, r3, #65
 261 005c 052C     		cmp	r4, #5
 262 005e 02D8     		bhi	.L18
 289:.././simpleserial/simpleserial.c **** 		else if(n_hi >= 'a' && n_hi <= 'f')
 263              		.loc 1 289 4 is_stmt 1 view .LVU74
 289:.././simpleserial/simpleserial.c **** 		else if(n_hi >= 'a' && n_hi <= 'f')
 264              		.loc 1 289 31 is_stmt 0 view .LVU75
 265 0060 A3F13704 		sub	r4, r3, #55
 266 0064 E2E7     		b	.L23
 267              	.L18:
 290:.././simpleserial/simpleserial.c **** 			data_buf[i] |= (n_hi - 'a' + 10) << 4;
 268              		.loc 1 290 8 is_stmt 1 view .LVU76
 290:.././simpleserial/simpleserial.c **** 			data_buf[i] |= (n_hi - 'a' + 10) << 4;
 269              		.loc 1 290 10 is_stmt 0 view .LVU77
 270 0066 A3F16104 		sub	r4, r3, #97
 271 006a 052C     		cmp	r4, #5
 272 006c F0D8     		bhi	.L19
 291:.././simpleserial/simpleserial.c **** 		else
 273              		.loc 1 291 4 is_stmt 1 view .LVU78
 291:.././simpleserial/simpleserial.c **** 		else
 274              		.loc 1 291 16 is_stmt 0 view .LVU79
 275 006e 1478     		ldrb	r4, [r2]	@ zero_extendqisi2
 291:.././simpleserial/simpleserial.c **** 		else
 276              		.loc 1 291 31 view .LVU80
 277 0070 573B     		subs	r3, r3, #87
 278              	.LVL30:
 291:.././simpleserial/simpleserial.c **** 		else
 279              		.loc 1 291 16 view .LVU81
 280 0072 44EA0313 		orr	r3, r4, r3, lsl #4
 281              	.LVL31:
 291:.././simpleserial/simpleserial.c **** 		else
 282              		.loc 1 291 16 view .LVU82
 283 0076 DCE7     		b	.L22
 284              	.LBE6:
 285              	.LBE9:
 286              		.cfi_endproc
 287              	.LFE4:
 289              		.section	.text.simpleserial_addcmd_flags,"ax",%progbits
 290              		.align	1
 291              		.global	simpleserial_addcmd_flags
 292              		.syntax unified
 293              		.thumb
 294              		.thumb_func
 295              		.fpu softvfp
 297              	simpleserial_addcmd_flags:
 298              	.LVL32:
 299              	.LFB7:
 298:.././simpleserial/simpleserial.c **** 
 299:.././simpleserial/simpleserial.c **** 
 300:.././simpleserial/simpleserial.c **** 
 301:.././simpleserial/simpleserial.c **** // Set up the SimpleSerial module by preparing internal commands
 302:.././simpleserial/simpleserial.c **** // This just adds the "v" command for now...
 303:.././simpleserial/simpleserial.c **** void simpleserial_init()
 304:.././simpleserial/simpleserial.c **** {
 305:.././simpleserial/simpleserial.c **** 	simpleserial_addcmd('v', 0, check_version);
 306:.././simpleserial/simpleserial.c ****     simpleserial_addcmd('w', 0, ss_get_commands);
 307:.././simpleserial/simpleserial.c ****     simpleserial_addcmd('y', 0, ss_num_commands);
 308:.././simpleserial/simpleserial.c **** }
 309:.././simpleserial/simpleserial.c **** 
 310:.././simpleserial/simpleserial.c **** int simpleserial_addcmd(char c, unsigned int len, uint8_t (*fp)(uint8_t*, uint8_t))
 311:.././simpleserial/simpleserial.c **** {
 312:.././simpleserial/simpleserial.c **** 	return simpleserial_addcmd_flags(c, len, fp, CMD_FLAG_NONE);
 313:.././simpleserial/simpleserial.c **** }
 314:.././simpleserial/simpleserial.c **** 
 315:.././simpleserial/simpleserial.c **** int simpleserial_addcmd_flags(char c, unsigned int len, uint8_t (*fp)(uint8_t*, uint8_t), uint8_t f
 316:.././simpleserial/simpleserial.c **** {
 300              		.loc 1 316 1 is_stmt 1 view -0
 301              		.cfi_startproc
 302              		@ args = 0, pretend = 0, frame = 0
 303              		@ frame_needed = 0, uses_anonymous_args = 0
 317:.././simpleserial/simpleserial.c **** 	if(num_commands >= MAX_SS_CMDS)
 304              		.loc 1 317 2 view .LVU84
 316:.././simpleserial/simpleserial.c **** 	if(num_commands >= MAX_SS_CMDS)
 305              		.loc 1 316 1 is_stmt 0 view .LVU85
 306 0000 70B5     		push	{r4, r5, r6, lr}
 307              	.LCFI1:
 308              		.cfi_def_cfa_offset 16
 309              		.cfi_offset 4, -16
 310              		.cfi_offset 5, -12
 311              		.cfi_offset 6, -8
 312              		.cfi_offset 14, -4
 313              		.loc 1 317 18 view .LVU86
 314 0002 094E     		ldr	r6, .L28
 315 0004 3468     		ldr	r4, [r6]
 316              		.loc 1 317 4 view .LVU87
 317 0006 0F2C     		cmp	r4, #15
 318 0008 0BDC     		bgt	.L27
 318:.././simpleserial/simpleserial.c **** 		return 1;
 319:.././simpleserial/simpleserial.c **** 
 320:.././simpleserial/simpleserial.c **** 	if(len >= MAX_SS_LEN)
 319              		.loc 1 320 2 is_stmt 1 view .LVU88
 320              		.loc 1 320 4 is_stmt 0 view .LVU89
 321 000a FF29     		cmp	r1, #255
 322 000c 09D8     		bhi	.L27
 321:.././simpleserial/simpleserial.c **** 		return 1;
 322:.././simpleserial/simpleserial.c **** 
 323:.././simpleserial/simpleserial.c **** 	commands[num_commands].c   = c;
 323              		.loc 1 323 2 is_stmt 1 view .LVU90
 324              		.loc 1 323 29 is_stmt 0 view .LVU91
 325 000e 06EB0415 		add	r5, r6, r4, lsl #4
 324:.././simpleserial/simpleserial.c **** 	commands[num_commands].len = len;
 325:.././simpleserial/simpleserial.c **** 	commands[num_commands].fp  = fp;
 326              		.loc 1 325 29 view .LVU92
 327 0012 C5E90212 		strd	r1, r2, [r5, #8]
 326:.././simpleserial/simpleserial.c **** 	commands[num_commands].flags = fl;
 327:.././simpleserial/simpleserial.c **** 	num_commands++;
 328              		.loc 1 327 14 view .LVU93
 329 0016 0134     		adds	r4, r4, #1
 323:.././simpleserial/simpleserial.c **** 	commands[num_commands].len = len;
 330              		.loc 1 323 29 view .LVU94
 331 0018 2871     		strb	r0, [r5, #4]
 324:.././simpleserial/simpleserial.c **** 	commands[num_commands].len = len;
 332              		.loc 1 324 2 is_stmt 1 view .LVU95
 326:.././simpleserial/simpleserial.c **** 	commands[num_commands].flags = fl;
 333              		.loc 1 326 2 view .LVU96
 326:.././simpleserial/simpleserial.c **** 	commands[num_commands].flags = fl;
 334              		.loc 1 326 31 is_stmt 0 view .LVU97
 335 001a 2B74     		strb	r3, [r5, #16]
 336              		.loc 1 327 2 is_stmt 1 view .LVU98
 337              		.loc 1 327 14 is_stmt 0 view .LVU99
 338 001c 3460     		str	r4, [r6]
 328:.././simpleserial/simpleserial.c **** 
 329:.././simpleserial/simpleserial.c **** 	return 0;
 339              		.loc 1 329 2 is_stmt 1 view .LVU100
 340              		.loc 1 329 9 is_stmt 0 view .LVU101
 341 001e 0020     		movs	r0, #0
 342              	.LVL33:
 343              	.L24:
 330:.././simpleserial/simpleserial.c **** }
 344              		.loc 1 330 1 view .LVU102
 345 0020 70BD     		pop	{r4, r5, r6, pc}
 346              	.LVL34:
 347              	.L27:
 318:.././simpleserial/simpleserial.c **** 
 348              		.loc 1 318 10 view .LVU103
 349 0022 0120     		movs	r0, #1
 350              	.LVL35:
 318:.././simpleserial/simpleserial.c **** 
 351              		.loc 1 318 10 view .LVU104
 352 0024 FCE7     		b	.L24
 353              	.L29:
 354 0026 00BF     		.align	2
 355              	.L28:
 356 0028 00000000 		.word	.LANCHOR0
 357              		.cfi_endproc
 358              	.LFE7:
 360              		.section	.text.simpleserial_addcmd,"ax",%progbits
 361              		.align	1
 362              		.global	simpleserial_addcmd
 363              		.syntax unified
 364              		.thumb
 365              		.thumb_func
 366              		.fpu softvfp
 368              	simpleserial_addcmd:
 369              	.LVL36:
 370              	.LFB6:
 311:.././simpleserial/simpleserial.c **** 	return simpleserial_addcmd_flags(c, len, fp, CMD_FLAG_NONE);
 371              		.loc 1 311 1 is_stmt 1 view -0
 372              		.cfi_startproc
 373              		@ args = 0, pretend = 0, frame = 0
 374              		@ frame_needed = 0, uses_anonymous_args = 0
 375              		@ link register save eliminated.
 312:.././simpleserial/simpleserial.c **** }
 376              		.loc 1 312 2 view .LVU106
 312:.././simpleserial/simpleserial.c **** }
 377              		.loc 1 312 9 is_stmt 0 view .LVU107
 378 0000 0023     		movs	r3, #0
 379 0002 FFF7FEBF 		b	simpleserial_addcmd_flags
 380              	.LVL37:
 312:.././simpleserial/simpleserial.c **** }
 381              		.loc 1 312 9 view .LVU108
 382              		.cfi_endproc
 383              	.LFE6:
 385              		.section	.text.simpleserial_init,"ax",%progbits
 386              		.align	1
 387              		.global	simpleserial_init
 388              		.syntax unified
 389              		.thumb
 390              		.thumb_func
 391              		.fpu softvfp
 393              	simpleserial_init:
 394              	.LFB5:
 304:.././simpleserial/simpleserial.c **** 	simpleserial_addcmd('v', 0, check_version);
 395              		.loc 1 304 1 is_stmt 1 view -0
 396              		.cfi_startproc
 397              		@ args = 0, pretend = 0, frame = 0
 398              		@ frame_needed = 0, uses_anonymous_args = 0
 305:.././simpleserial/simpleserial.c ****     simpleserial_addcmd('w', 0, ss_get_commands);
 399              		.loc 1 305 2 view .LVU110
 304:.././simpleserial/simpleserial.c **** 	simpleserial_addcmd('v', 0, check_version);
 400              		.loc 1 304 1 is_stmt 0 view .LVU111
 401 0000 08B5     		push	{r3, lr}
 402              	.LCFI2:
 403              		.cfi_def_cfa_offset 8
 404              		.cfi_offset 3, -8
 405              		.cfi_offset 14, -4
 305:.././simpleserial/simpleserial.c ****     simpleserial_addcmd('w', 0, ss_get_commands);
 406              		.loc 1 305 2 view .LVU112
 407 0002 074A     		ldr	r2, .L32
 408 0004 0021     		movs	r1, #0
 409 0006 7620     		movs	r0, #118
 410 0008 FFF7FEFF 		bl	simpleserial_addcmd
 411              	.LVL38:
 306:.././simpleserial/simpleserial.c ****     simpleserial_addcmd('y', 0, ss_num_commands);
 412              		.loc 1 306 5 is_stmt 1 view .LVU113
 413 000c 054A     		ldr	r2, .L32+4
 414 000e 7720     		movs	r0, #119
 415 0010 FFF7FEFF 		bl	simpleserial_addcmd
 416              	.LVL39:
 307:.././simpleserial/simpleserial.c **** }
 417              		.loc 1 307 5 view .LVU114
 308:.././simpleserial/simpleserial.c **** 
 418              		.loc 1 308 1 is_stmt 0 view .LVU115
 419 0014 BDE80840 		pop	{r3, lr}
 420              	.LCFI3:
 421              		.cfi_restore 14
 422              		.cfi_restore 3
 423              		.cfi_def_cfa_offset 0
 307:.././simpleserial/simpleserial.c **** }
 424              		.loc 1 307 5 view .LVU116
 425 0018 034A     		ldr	r2, .L32+8
 426 001a 7920     		movs	r0, #121
 427 001c FFF7FEBF 		b	simpleserial_addcmd
 428              	.LVL40:
 429              	.L33:
 430              		.align	2
 431              	.L32:
 432 0020 00000000 		.word	check_version
 433 0024 00000000 		.word	ss_get_commands
 434 0028 00000000 		.word	ss_num_commands
 435              		.cfi_endproc
 436              	.LFE5:
 438              		.section	.text.simpleserial_put,"ax",%progbits
 439              		.align	1
 440              		.global	simpleserial_put
 441              		.syntax unified
 442              		.thumb
 443              		.thumb_func
 444              		.fpu softvfp
 446              	simpleserial_put:
 447              	.LVL41:
 448              	.LFB9:
 331:.././simpleserial/simpleserial.c **** 
 332:.././simpleserial/simpleserial.c **** void simpleserial_get(void)
 333:.././simpleserial/simpleserial.c **** {
 334:.././simpleserial/simpleserial.c **** 	char ascii_buf[2*MAX_SS_LEN];
 335:.././simpleserial/simpleserial.c **** 	uint8_t data_buf[MAX_SS_LEN];
 336:.././simpleserial/simpleserial.c **** 	char c;
 337:.././simpleserial/simpleserial.c **** 
 338:.././simpleserial/simpleserial.c **** 	// Find which command we're receiving
 339:.././simpleserial/simpleserial.c **** 	c = getch();
 340:.././simpleserial/simpleserial.c **** 
 341:.././simpleserial/simpleserial.c **** 	int cmd;
 342:.././simpleserial/simpleserial.c **** 	for(cmd = 0; cmd < num_commands; cmd++)
 343:.././simpleserial/simpleserial.c **** 	{
 344:.././simpleserial/simpleserial.c **** 		if(commands[cmd].c == c)
 345:.././simpleserial/simpleserial.c **** 			break;
 346:.././simpleserial/simpleserial.c **** 	}
 347:.././simpleserial/simpleserial.c **** 
 348:.././simpleserial/simpleserial.c **** 	// If we didn't find a match, give up right away
 349:.././simpleserial/simpleserial.c **** 	if(cmd == num_commands)
 350:.././simpleserial/simpleserial.c **** 		return;
 351:.././simpleserial/simpleserial.c **** 
 352:.././simpleserial/simpleserial.c **** 	// If flag CMD_FLAG_LEN is set, the next byte indicates the sent length
 353:.././simpleserial/simpleserial.c **** 	if ((commands[cmd].flags & CMD_FLAG_LEN) != 0)
 354:.././simpleserial/simpleserial.c **** 	{
 355:.././simpleserial/simpleserial.c **** 		uint8_t l = 0;
 356:.././simpleserial/simpleserial.c **** 		char buff[2];
 357:.././simpleserial/simpleserial.c **** 		buff[0] = getch();
 358:.././simpleserial/simpleserial.c **** 		buff[1] = getch();
 359:.././simpleserial/simpleserial.c **** 		if (hex_decode(1, buff, &l))
 360:.././simpleserial/simpleserial.c **** 			return;
 361:.././simpleserial/simpleserial.c **** 		commands[cmd].len = l;
 362:.././simpleserial/simpleserial.c **** 	}
 363:.././simpleserial/simpleserial.c **** 
 364:.././simpleserial/simpleserial.c **** 	// Receive characters until we fill the ASCII buffer
 365:.././simpleserial/simpleserial.c **** 	for(int i = 0; i < 2*commands[cmd].len; i++)
 366:.././simpleserial/simpleserial.c **** 	{
 367:.././simpleserial/simpleserial.c **** 		c = getch();
 368:.././simpleserial/simpleserial.c **** 
 369:.././simpleserial/simpleserial.c **** 		// Check for early \n
 370:.././simpleserial/simpleserial.c **** 		if(c == '\n' || c == '\r')
 371:.././simpleserial/simpleserial.c **** 			return;
 372:.././simpleserial/simpleserial.c **** 
 373:.././simpleserial/simpleserial.c **** 		ascii_buf[i] = c;
 374:.././simpleserial/simpleserial.c **** 	}
 375:.././simpleserial/simpleserial.c **** 
 376:.././simpleserial/simpleserial.c **** 	// Assert that last character is \n or \r
 377:.././simpleserial/simpleserial.c **** 	c = getch();
 378:.././simpleserial/simpleserial.c **** 	if(c != '\n' && c != '\r')
 379:.././simpleserial/simpleserial.c **** 		return;
 380:.././simpleserial/simpleserial.c **** 
 381:.././simpleserial/simpleserial.c **** 	// ASCII buffer is full: convert to bytes
 382:.././simpleserial/simpleserial.c **** 	// Check for illegal characters here
 383:.././simpleserial/simpleserial.c **** 	if(hex_decode(commands[cmd].len, ascii_buf, data_buf))
 384:.././simpleserial/simpleserial.c **** 		return;
 385:.././simpleserial/simpleserial.c **** 
 386:.././simpleserial/simpleserial.c **** 	// Callback
 387:.././simpleserial/simpleserial.c **** 	uint8_t ret[1];
 388:.././simpleserial/simpleserial.c **** 	ret[0] = commands[cmd].fp(data_buf, commands[cmd].len);
 389:.././simpleserial/simpleserial.c **** 
 390:.././simpleserial/simpleserial.c **** 	// Acknowledge (if version is 1.1)
 391:.././simpleserial/simpleserial.c **** #if SS_VER == SS_VER_1_1
 392:.././simpleserial/simpleserial.c **** 	simpleserial_put('z', 1, ret);
 393:.././simpleserial/simpleserial.c **** #endif
 394:.././simpleserial/simpleserial.c **** }
 395:.././simpleserial/simpleserial.c **** 
 396:.././simpleserial/simpleserial.c **** void simpleserial_put(char c, uint8_t size, uint8_t* output)
 397:.././simpleserial/simpleserial.c **** {
 449              		.loc 1 397 1 is_stmt 1 view -0
 450              		.cfi_startproc
 451              		@ args = 0, pretend = 0, frame = 0
 452              		@ frame_needed = 0, uses_anonymous_args = 0
 398:.././simpleserial/simpleserial.c **** 	// Write first character
 399:.././simpleserial/simpleserial.c **** 	putch(c);
 453              		.loc 1 399 2 view .LVU118
 397:.././simpleserial/simpleserial.c **** 	// Write first character
 454              		.loc 1 397 1 is_stmt 0 view .LVU119
 455 0000 F8B5     		push	{r3, r4, r5, r6, r7, lr}
 456              	.LCFI4:
 457              		.cfi_def_cfa_offset 24
 458              		.cfi_offset 3, -24
 459              		.cfi_offset 4, -20
 460              		.cfi_offset 5, -16
 461              		.cfi_offset 6, -12
 462              		.cfi_offset 7, -8
 463              		.cfi_offset 14, -4
 397:.././simpleserial/simpleserial.c **** 	// Write first character
 464              		.loc 1 397 1 view .LVU120
 465 0002 1446     		mov	r4, r2
 466 0004 0E46     		mov	r6, r1
 467              		.loc 1 399 2 view .LVU121
 468 0006 FFF7FEFF 		bl	putch
 469              	.LVL42:
 400:.././simpleserial/simpleserial.c **** 
 401:.././simpleserial/simpleserial.c **** 	// Write each byte as two nibbles
 402:.././simpleserial/simpleserial.c **** 	for(int i = 0; i < size; i++)
 470              		.loc 1 402 2 is_stmt 1 view .LVU122
 471              	.LBB10:
 472              		.loc 1 402 6 view .LVU123
 403:.././simpleserial/simpleserial.c **** 	{
 404:.././simpleserial/simpleserial.c **** 		putch(hex_lookup[output[i] >> 4 ]);
 473              		.loc 1 404 3 is_stmt 0 view .LVU124
 474 000a 0C4F     		ldr	r7, .L37
 475 000c 651E     		subs	r5, r4, #1
 402:.././simpleserial/simpleserial.c **** 	{
 476              		.loc 1 402 2 view .LVU125
 477 000e C4F10104 		rsb	r4, r4, #1
 478              	.LVL43:
 479              	.L35:
 402:.././simpleserial/simpleserial.c **** 	{
 480              		.loc 1 402 17 is_stmt 1 discriminator 1 view .LVU126
 402:.././simpleserial/simpleserial.c **** 	{
 481              		.loc 1 402 2 is_stmt 0 discriminator 1 view .LVU127
 482 0012 6319     		adds	r3, r4, r5
 483 0014 9E42     		cmp	r6, r3
 484 0016 04DC     		bgt	.L36
 485              	.LBE10:
 405:.././simpleserial/simpleserial.c **** 		putch(hex_lookup[output[i] & 0xF]);
 406:.././simpleserial/simpleserial.c **** 	}
 407:.././simpleserial/simpleserial.c **** 
 408:.././simpleserial/simpleserial.c **** 	// Write trailing '\n'
 409:.././simpleserial/simpleserial.c **** 	putch('\n');
 486              		.loc 1 409 2 is_stmt 1 view .LVU128
 410:.././simpleserial/simpleserial.c **** }
 487              		.loc 1 410 1 is_stmt 0 view .LVU129
 488 0018 BDE8F840 		pop	{r3, r4, r5, r6, r7, lr}
 489              	.LCFI5:
 490              		.cfi_remember_state
 491              		.cfi_restore 14
 492              		.cfi_restore 7
 493              		.cfi_restore 6
 494              		.cfi_restore 5
 495              		.cfi_restore 4
 496              		.cfi_restore 3
 497              		.cfi_def_cfa_offset 0
 409:.././simpleserial/simpleserial.c **** }
 498              		.loc 1 409 2 view .LVU130
 499 001c 0A20     		movs	r0, #10
 500 001e FFF7FEBF 		b	putch
 501              	.LVL44:
 502              	.L36:
 503              	.LCFI6:
 504              		.cfi_restore_state
 505              	.LBB11:
 404:.././simpleserial/simpleserial.c **** 		putch(hex_lookup[output[i] & 0xF]);
 506              		.loc 1 404 3 is_stmt 1 discriminator 3 view .LVU131
 404:.././simpleserial/simpleserial.c **** 		putch(hex_lookup[output[i] & 0xF]);
 507              		.loc 1 404 30 is_stmt 0 discriminator 3 view .LVU132
 508 0022 15F8013F 		ldrb	r3, [r5, #1]!	@ zero_extendqisi2
 509 0026 1B09     		lsrs	r3, r3, #4
 404:.././simpleserial/simpleserial.c **** 		putch(hex_lookup[output[i] & 0xF]);
 510              		.loc 1 404 3 discriminator 3 view .LVU133
 511 0028 F85C     		ldrb	r0, [r7, r3]	@ zero_extendqisi2
 512 002a FFF7FEFF 		bl	putch
 513              	.LVL45:
 405:.././simpleserial/simpleserial.c **** 	}
 514              		.loc 1 405 3 is_stmt 1 discriminator 3 view .LVU134
 405:.././simpleserial/simpleserial.c **** 	}
 515              		.loc 1 405 30 is_stmt 0 discriminator 3 view .LVU135
 516 002e 2B78     		ldrb	r3, [r5]	@ zero_extendqisi2
 517 0030 03F00F03 		and	r3, r3, #15
 405:.././simpleserial/simpleserial.c **** 	}
 518              		.loc 1 405 3 discriminator 3 view .LVU136
 519 0034 F85C     		ldrb	r0, [r7, r3]	@ zero_extendqisi2
 520 0036 FFF7FEFF 		bl	putch
 521              	.LVL46:
 402:.././simpleserial/simpleserial.c **** 	{
 522              		.loc 1 402 27 is_stmt 1 discriminator 3 view .LVU137
 523 003a EAE7     		b	.L35
 524              	.L38:
 525              		.align	2
 526              	.L37:
 527 003c 00000000 		.word	.LANCHOR1
 528              	.LBE11:
 529              		.cfi_endproc
 530              	.LFE9:
 532              		.section	.text.ss_num_commands,"ax",%progbits
 533              		.align	1
 534              		.global	ss_num_commands
 535              		.syntax unified
 536              		.thumb
 537              		.thumb_func
 538              		.fpu softvfp
 540              	ss_num_commands:
 541              	.LVL47:
 542              	.LFB2:
 239:.././simpleserial/simpleserial.c ****     uint8_t ncmds = num_commands & 0xFF;
 543              		.loc 1 239 1 view -0
 544              		.cfi_startproc
 545              		@ args = 0, pretend = 0, frame = 8
 546              		@ frame_needed = 0, uses_anonymous_args = 0
 240:.././simpleserial/simpleserial.c ****     simpleserial_put('r', 0x01, &ncmds);
 547              		.loc 1 240 5 view .LVU139
 239:.././simpleserial/simpleserial.c ****     uint8_t ncmds = num_commands & 0xFF;
 548              		.loc 1 239 1 is_stmt 0 view .LVU140
 549 0000 07B5     		push	{r0, r1, r2, lr}
 550              	.LCFI7:
 551              		.cfi_def_cfa_offset 16
 552              		.cfi_offset 14, -4
 240:.././simpleserial/simpleserial.c ****     simpleserial_put('r', 0x01, &ncmds);
 553              		.loc 1 240 13 view .LVU141
 554 0002 074B     		ldr	r3, .L40
 241:.././simpleserial/simpleserial.c ****     return 0x00;
 555              		.loc 1 241 5 view .LVU142
 556 0004 0DF10702 		add	r2, sp, #7
 240:.././simpleserial/simpleserial.c ****     simpleserial_put('r', 0x01, &ncmds);
 557              		.loc 1 240 13 view .LVU143
 558 0008 1B68     		ldr	r3, [r3]
 559 000a 8DF80730 		strb	r3, [sp, #7]
 241:.././simpleserial/simpleserial.c ****     return 0x00;
 560              		.loc 1 241 5 is_stmt 1 view .LVU144
 561 000e 0121     		movs	r1, #1
 562              	.LVL48:
 241:.././simpleserial/simpleserial.c ****     return 0x00;
 563              		.loc 1 241 5 is_stmt 0 view .LVU145
 564 0010 7220     		movs	r0, #114
 565              	.LVL49:
 241:.././simpleserial/simpleserial.c ****     return 0x00;
 566              		.loc 1 241 5 view .LVU146
 567 0012 FFF7FEFF 		bl	simpleserial_put
 568              	.LVL50:
 242:.././simpleserial/simpleserial.c **** }
 569              		.loc 1 242 5 is_stmt 1 view .LVU147
 243:.././simpleserial/simpleserial.c **** 
 570              		.loc 1 243 1 is_stmt 0 view .LVU148
 571 0016 0020     		movs	r0, #0
 572 0018 03B0     		add	sp, sp, #12
 573              	.LCFI8:
 574              		.cfi_def_cfa_offset 4
 575              		@ sp needed
 576 001a 5DF804FB 		ldr	pc, [sp], #4
 577              	.L41:
 578 001e 00BF     		.align	2
 579              	.L40:
 580 0020 00000000 		.word	.LANCHOR0
 581              		.cfi_endproc
 582              	.LFE2:
 584              		.section	.text.ss_get_commands,"ax",%progbits
 585              		.align	1
 586              		.global	ss_get_commands
 587              		.syntax unified
 588              		.thumb
 589              		.thumb_func
 590              		.fpu softvfp
 592              	ss_get_commands:
 593              	.LVL51:
 594              	.LFB3:
 252:.././simpleserial/simpleserial.c ****     ss_cmd_repr repr_cmd_buf[MAX_SS_CMDS];
 595              		.loc 1 252 1 is_stmt 1 view -0
 596              		.cfi_startproc
 597              		@ args = 0, pretend = 0, frame = 48
 598              		@ frame_needed = 0, uses_anonymous_args = 0
 253:.././simpleserial/simpleserial.c ****     for (uint8_t i = 0; i < (num_commands & 0xFF); i++) {
 599              		.loc 1 253 5 view .LVU150
 254:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].c = commands[i].c;
 600              		.loc 1 254 5 view .LVU151
 601              	.LBB12:
 254:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].c = commands[i].c;
 602              		.loc 1 254 10 view .LVU152
 254:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].c = commands[i].c;
 603              		.loc 1 254 10 is_stmt 0 view .LVU153
 604              	.LBE12:
 252:.././simpleserial/simpleserial.c ****     ss_cmd_repr repr_cmd_buf[MAX_SS_CMDS];
 605              		.loc 1 252 1 view .LVU154
 606 0000 70B5     		push	{r4, r5, r6, lr}
 607              	.LCFI9:
 608              		.cfi_def_cfa_offset 16
 609              		.cfi_offset 4, -16
 610              		.cfi_offset 5, -12
 611              		.cfi_offset 6, -8
 612              		.cfi_offset 14, -4
 613              	.LBB13:
 254:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].c = commands[i].c;
 614              		.loc 1 254 43 view .LVU155
 615 0002 124C     		ldr	r4, .L45
 616 0004 2168     		ldr	r1, [r4]
 617              	.LVL52:
 254:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].c = commands[i].c;
 618              		.loc 1 254 43 view .LVU156
 619              	.LBE13:
 252:.././simpleserial/simpleserial.c ****     ss_cmd_repr repr_cmd_buf[MAX_SS_CMDS];
 620              		.loc 1 252 1 view .LVU157
 621 0006 8CB0     		sub	sp, sp, #48
 622              	.LCFI10:
 623              		.cfi_def_cfa_offset 64
 624              	.LBB14:
 254:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].c = commands[i].c;
 625              		.loc 1 254 43 view .LVU158
 626 0008 CDB2     		uxtb	r5, r1
 254:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].c = commands[i].c;
 627              		.loc 1 254 5 view .LVU159
 628 000a 0020     		movs	r0, #0
 629              	.LVL53:
 630              	.L43:
 254:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].c = commands[i].c;
 631              		.loc 1 254 25 is_stmt 1 discriminator 1 view .LVU160
 254:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].c = commands[i].c;
 632              		.loc 1 254 27 is_stmt 0 discriminator 1 view .LVU161
 633 000c C3B2     		uxtb	r3, r0
 254:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].c = commands[i].c;
 634              		.loc 1 254 5 discriminator 1 view .LVU162
 635 000e AB42     		cmp	r3, r5
 636 0010 00F10100 		add	r0, r0, #1
 637              	.LVL54:
 254:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].c = commands[i].c;
 638              		.loc 1 254 5 discriminator 1 view .LVU163
 639 0014 09DB     		blt	.L44
 640              	.LBE14:
 260:.././simpleserial/simpleserial.c ****     return 0x00;
 641              		.loc 1 260 5 is_stmt 1 view .LVU164
 642 0016 01EB4101 		add	r1, r1, r1, lsl #1
 643 001a 6A46     		mov	r2, sp
 644 001c C9B2     		uxtb	r1, r1
 645 001e 7220     		movs	r0, #114
 646 0020 FFF7FEFF 		bl	simpleserial_put
 647              	.LVL55:
 261:.././simpleserial/simpleserial.c **** }
 648              		.loc 1 261 5 view .LVU165
 262:.././simpleserial/simpleserial.c **** 
 649              		.loc 1 262 1 is_stmt 0 view .LVU166
 650 0024 0020     		movs	r0, #0
 651 0026 0CB0     		add	sp, sp, #48
 652              	.LCFI11:
 653              		.cfi_remember_state
 654              		.cfi_def_cfa_offset 16
 655              		@ sp needed
 656 0028 70BD     		pop	{r4, r5, r6, pc}
 657              	.LVL56:
 658              	.L44:
 659              	.LCFI12:
 660              		.cfi_restore_state
 661              	.LBB15:
 255:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].len = commands[i].len;
 662              		.loc 1 255 9 is_stmt 1 discriminator 3 view .LVU167
 255:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].len = commands[i].len;
 663              		.loc 1 255 27 is_stmt 0 discriminator 3 view .LVU168
 664 002a 03EB4302 		add	r2, r3, r3, lsl #1
 665 002e 0CAE     		add	r6, sp, #48
 255:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].len = commands[i].len;
 666              		.loc 1 255 40 discriminator 3 view .LVU169
 667 0030 04EB0313 		add	r3, r4, r3, lsl #4
 668              	.LVL57:
 255:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].len = commands[i].len;
 669              		.loc 1 255 27 discriminator 3 view .LVU170
 670 0034 3244     		add	r2, r2, r6
 671 0036 1E79     		ldrb	r6, [r3, #4]	@ zero_extendqisi2
 672 0038 02F8306C 		strb	r6, [r2, #-48]
 256:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].flags = commands[i].flags;
 673              		.loc 1 256 9 is_stmt 1 discriminator 3 view .LVU171
 256:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].flags = commands[i].flags;
 674              		.loc 1 256 29 is_stmt 0 discriminator 3 view .LVU172
 675 003c 9E68     		ldr	r6, [r3, #8]
 257:.././simpleserial/simpleserial.c ****     }
 676              		.loc 1 257 31 discriminator 3 view .LVU173
 677 003e 1B7C     		ldrb	r3, [r3, #16]	@ zero_extendqisi2
 256:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].flags = commands[i].flags;
 678              		.loc 1 256 29 discriminator 3 view .LVU174
 679 0040 02F82F6C 		strb	r6, [r2, #-47]
 257:.././simpleserial/simpleserial.c ****     }
 680              		.loc 1 257 9 is_stmt 1 discriminator 3 view .LVU175
 257:.././simpleserial/simpleserial.c ****     }
 681              		.loc 1 257 31 is_stmt 0 discriminator 3 view .LVU176
 682 0044 02F82E3C 		strb	r3, [r2, #-46]
 254:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].c = commands[i].c;
 683              		.loc 1 254 52 is_stmt 1 discriminator 3 view .LVU177
 684              	.LVL58:
 254:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].c = commands[i].c;
 685              		.loc 1 254 52 is_stmt 0 discriminator 3 view .LVU178
 686 0048 E0E7     		b	.L43
 687              	.L46:
 688 004a 00BF     		.align	2
 689              	.L45:
 690 004c 00000000 		.word	.LANCHOR0
 691              	.LBE15:
 692              		.cfi_endproc
 693              	.LFE3:
 695              		.section	.text.simpleserial_get,"ax",%progbits
 696              		.align	1
 697              		.global	simpleserial_get
 698              		.syntax unified
 699              		.thumb
 700              		.thumb_func
 701              		.fpu softvfp
 703              	simpleserial_get:
 704              	.LFB8:
 333:.././simpleserial/simpleserial.c **** 	char ascii_buf[2*MAX_SS_LEN];
 705              		.loc 1 333 1 is_stmt 1 view -0
 706              		.cfi_startproc
 707              		@ args = 0, pretend = 0, frame = 776
 708              		@ frame_needed = 0, uses_anonymous_args = 0
 334:.././simpleserial/simpleserial.c **** 	uint8_t data_buf[MAX_SS_LEN];
 709              		.loc 1 334 2 view .LVU180
 335:.././simpleserial/simpleserial.c **** 	char c;
 710              		.loc 1 335 2 view .LVU181
 336:.././simpleserial/simpleserial.c **** 
 711              		.loc 1 336 2 view .LVU182
 339:.././simpleserial/simpleserial.c **** 
 712              		.loc 1 339 2 view .LVU183
 333:.././simpleserial/simpleserial.c **** 	char ascii_buf[2*MAX_SS_LEN];
 713              		.loc 1 333 1 is_stmt 0 view .LVU184
 714 0000 2DE9F041 		push	{r4, r5, r6, r7, r8, lr}
 715              	.LCFI13:
 716              		.cfi_def_cfa_offset 24
 717              		.cfi_offset 4, -24
 718              		.cfi_offset 5, -20
 719              		.cfi_offset 6, -16
 720              		.cfi_offset 7, -12
 721              		.cfi_offset 8, -8
 722              		.cfi_offset 14, -4
 342:.././simpleserial/simpleserial.c **** 	{
 723              		.loc 1 342 19 view .LVU185
 724 0004 2F4D     		ldr	r5, .L70
 333:.././simpleserial/simpleserial.c **** 	char ascii_buf[2*MAX_SS_LEN];
 725              		.loc 1 333 1 view .LVU186
 726 0006 ADF5427D 		sub	sp, sp, #776
 727              	.LCFI14:
 728              		.cfi_def_cfa_offset 800
 339:.././simpleserial/simpleserial.c **** 
 729              		.loc 1 339 6 view .LVU187
 730 000a FFF7FEFF 		bl	getch
 731              	.LVL59:
 341:.././simpleserial/simpleserial.c **** 	for(cmd = 0; cmd < num_commands; cmd++)
 732              		.loc 1 341 2 is_stmt 1 view .LVU188
 342:.././simpleserial/simpleserial.c **** 	{
 733              		.loc 1 342 2 view .LVU189
 342:.././simpleserial/simpleserial.c **** 	{
 734              		.loc 1 342 19 is_stmt 0 view .LVU190
 735 000e 2A46     		mov	r2, r5
 342:.././simpleserial/simpleserial.c **** 	{
 736              		.loc 1 342 10 view .LVU191
 737 0010 0023     		movs	r3, #0
 342:.././simpleserial/simpleserial.c **** 	{
 738              		.loc 1 342 19 view .LVU192
 739 0012 52F8041B 		ldr	r1, [r2], #4
 740              	.LVL60:
 741              	.L48:
 342:.././simpleserial/simpleserial.c **** 	{
 742              		.loc 1 342 15 is_stmt 1 discriminator 1 view .LVU193
 342:.././simpleserial/simpleserial.c **** 	{
 743              		.loc 1 342 2 is_stmt 0 discriminator 1 view .LVU194
 744 0016 9942     		cmp	r1, r3
 745 0018 04DC     		bgt	.L52
 349:.././simpleserial/simpleserial.c **** 		return;
 746              		.loc 1 349 2 is_stmt 1 view .LVU195
 349:.././simpleserial/simpleserial.c **** 		return;
 747              		.loc 1 349 4 is_stmt 0 view .LVU196
 748 001a 07D1     		bne	.L54
 749              	.LVL61:
 750              	.L47:
 394:.././simpleserial/simpleserial.c **** 
 751              		.loc 1 394 1 view .LVU197
 752 001c 0DF5427D 		add	sp, sp, #776
 753              	.LCFI15:
 754              		.cfi_remember_state
 755              		.cfi_def_cfa_offset 24
 756              		@ sp needed
 757 0020 BDE8F081 		pop	{r4, r5, r6, r7, r8, pc}
 758              	.LVL62:
 759              	.L52:
 760              	.LCFI16:
 761              		.cfi_restore_state
 344:.././simpleserial/simpleserial.c **** 			break;
 762              		.loc 1 344 3 is_stmt 1 view .LVU198
 344:.././simpleserial/simpleserial.c **** 			break;
 763              		.loc 1 344 19 is_stmt 0 view .LVU199
 764 0024 1C01     		lsls	r4, r3, #4
 344:.././simpleserial/simpleserial.c **** 			break;
 765              		.loc 1 344 5 view .LVU200
 766 0026 A45C     		ldrb	r4, [r4, r2]	@ zero_extendqisi2
 767 0028 8442     		cmp	r4, r0
 768 002a 3ED1     		bne	.L49
 769              	.L54:
 353:.././simpleserial/simpleserial.c **** 	{
 770              		.loc 1 353 2 is_stmt 1 view .LVU201
 353:.././simpleserial/simpleserial.c **** 	{
 771              		.loc 1 353 20 is_stmt 0 view .LVU202
 772 002c 05EB0314 		add	r4, r5, r3, lsl #4
 773 0030 1E01     		lsls	r6, r3, #4
 353:.././simpleserial/simpleserial.c **** 	{
 774              		.loc 1 353 5 view .LVU203
 775 0032 237C     		ldrb	r3, [r4, #16]	@ zero_extendqisi2
 776              	.LVL63:
 353:.././simpleserial/simpleserial.c **** 	{
 777              		.loc 1 353 5 view .LVU204
 778 0034 DB07     		lsls	r3, r3, #31
 779 0036 14D5     		bpl	.L51
 780              	.LBB16:
 355:.././simpleserial/simpleserial.c **** 		char buff[2];
 781              		.loc 1 355 3 is_stmt 1 view .LVU205
 355:.././simpleserial/simpleserial.c **** 		char buff[2];
 782              		.loc 1 355 11 is_stmt 0 view .LVU206
 783 0038 0023     		movs	r3, #0
 784 003a 8DF80830 		strb	r3, [sp, #8]
 356:.././simpleserial/simpleserial.c **** 		buff[0] = getch();
 785              		.loc 1 356 3 is_stmt 1 view .LVU207
 357:.././simpleserial/simpleserial.c **** 		buff[1] = getch();
 786              		.loc 1 357 3 view .LVU208
 357:.././simpleserial/simpleserial.c **** 		buff[1] = getch();
 787              		.loc 1 357 13 is_stmt 0 view .LVU209
 788 003e FFF7FEFF 		bl	getch
 789              	.LVL64:
 357:.././simpleserial/simpleserial.c **** 		buff[1] = getch();
 790              		.loc 1 357 11 view .LVU210
 791 0042 8DF80801 		strb	r0, [sp, #264]
 358:.././simpleserial/simpleserial.c **** 		if (hex_decode(1, buff, &l))
 792              		.loc 1 358 3 is_stmt 1 view .LVU211
 358:.././simpleserial/simpleserial.c **** 		if (hex_decode(1, buff, &l))
 793              		.loc 1 358 13 is_stmt 0 view .LVU212
 794 0046 FFF7FEFF 		bl	getch
 795              	.LVL65:
 359:.././simpleserial/simpleserial.c **** 			return;
 796              		.loc 1 359 7 view .LVU213
 797 004a 02AA     		add	r2, sp, #8
 358:.././simpleserial/simpleserial.c **** 		if (hex_decode(1, buff, &l))
 798              		.loc 1 358 11 view .LVU214
 799 004c 8DF80901 		strb	r0, [sp, #265]
 359:.././simpleserial/simpleserial.c **** 			return;
 800              		.loc 1 359 3 is_stmt 1 view .LVU215
 359:.././simpleserial/simpleserial.c **** 			return;
 801              		.loc 1 359 7 is_stmt 0 view .LVU216
 802 0050 42A9     		add	r1, sp, #264
 803 0052 0120     		movs	r0, #1
 804 0054 FFF7FEFF 		bl	hex_decode
 805              	.LVL66:
 359:.././simpleserial/simpleserial.c **** 			return;
 806              		.loc 1 359 6 view .LVU217
 807 0058 0028     		cmp	r0, #0
 808 005a DFD1     		bne	.L47
 361:.././simpleserial/simpleserial.c **** 	}
 809              		.loc 1 361 3 is_stmt 1 view .LVU218
 361:.././simpleserial/simpleserial.c **** 	}
 810              		.loc 1 361 21 is_stmt 0 view .LVU219
 811 005c 9DF80830 		ldrb	r3, [sp, #8]	@ zero_extendqisi2
 812 0060 A360     		str	r3, [r4, #8]
 813              	.L51:
 814 0062 42AF     		add	r7, sp, #264
 815              	.LBE16:
 342:.././simpleserial/simpleserial.c **** 	{
 816              		.loc 1 342 10 discriminator 1 view .LVU220
 817 0064 0024     		movs	r4, #0
 818              	.LBB17:
 365:.././simpleserial/simpleserial.c **** 	{
 819              		.loc 1 365 36 discriminator 1 view .LVU221
 820 0066 05EB0608 		add	r8, r5, r6
 821              	.L57:
 822              	.LVL67:
 365:.././simpleserial/simpleserial.c **** 	{
 823              		.loc 1 365 17 is_stmt 1 discriminator 1 view .LVU222
 365:.././simpleserial/simpleserial.c **** 	{
 824              		.loc 1 365 22 is_stmt 0 discriminator 1 view .LVU223
 825 006a D8F80830 		ldr	r3, [r8, #8]
 365:.././simpleserial/simpleserial.c **** 	{
 826              		.loc 1 365 2 discriminator 1 view .LVU224
 827 006e B4EB430F 		cmp	r4, r3, lsl #1
 828 0072 1CD3     		bcc	.L58
 829              	.LBE17:
 377:.././simpleserial/simpleserial.c **** 	if(c != '\n' && c != '\r')
 830              		.loc 1 377 2 is_stmt 1 view .LVU225
 377:.././simpleserial/simpleserial.c **** 	if(c != '\n' && c != '\r')
 831              		.loc 1 377 6 is_stmt 0 view .LVU226
 832 0074 FFF7FEFF 		bl	getch
 833              	.LVL68:
 378:.././simpleserial/simpleserial.c **** 		return;
 834              		.loc 1 378 2 is_stmt 1 view .LVU227
 378:.././simpleserial/simpleserial.c **** 		return;
 835              		.loc 1 378 4 is_stmt 0 view .LVU228
 836 0078 0A28     		cmp	r0, #10
 837 007a 01D0     		beq	.L59
 378:.././simpleserial/simpleserial.c **** 		return;
 838              		.loc 1 378 15 discriminator 1 view .LVU229
 839 007c 0D28     		cmp	r0, #13
 840 007e CDD1     		bne	.L47
 841              	.L59:
 383:.././simpleserial/simpleserial.c **** 		return;
 842              		.loc 1 383 2 is_stmt 1 view .LVU230
 383:.././simpleserial/simpleserial.c **** 		return;
 843              		.loc 1 383 29 is_stmt 0 view .LVU231
 844 0080 3544     		add	r5, r5, r6
 383:.././simpleserial/simpleserial.c **** 		return;
 845              		.loc 1 383 5 view .LVU232
 846 0082 02AA     		add	r2, sp, #8
 383:.././simpleserial/simpleserial.c **** 		return;
 847              		.loc 1 383 29 view .LVU233
 848 0084 AC68     		ldr	r4, [r5, #8]
 849              	.LVL69:
 383:.././simpleserial/simpleserial.c **** 		return;
 850              		.loc 1 383 5 view .LVU234
 851 0086 42A9     		add	r1, sp, #264
 852 0088 2046     		mov	r0, r4
 853              	.LVL70:
 383:.././simpleserial/simpleserial.c **** 		return;
 854              		.loc 1 383 5 view .LVU235
 855 008a FFF7FEFF 		bl	hex_decode
 856              	.LVL71:
 383:.././simpleserial/simpleserial.c **** 		return;
 857              		.loc 1 383 4 view .LVU236
 858 008e 0028     		cmp	r0, #0
 859 0090 C4D1     		bne	.L47
 387:.././simpleserial/simpleserial.c **** 	ret[0] = commands[cmd].fp(data_buf, commands[cmd].len);
 860              		.loc 1 387 2 is_stmt 1 view .LVU237
 388:.././simpleserial/simpleserial.c **** 
 861              		.loc 1 388 2 view .LVU238
 388:.././simpleserial/simpleserial.c **** 
 862              		.loc 1 388 11 is_stmt 0 view .LVU239
 863 0092 E1B2     		uxtb	r1, r4
 864 0094 EB68     		ldr	r3, [r5, #12]
 865 0096 02A8     		add	r0, sp, #8
 866 0098 9847     		blx	r3
 867              	.LVL72:
 392:.././simpleserial/simpleserial.c **** #endif
 868              		.loc 1 392 2 view .LVU240
 869 009a 01AA     		add	r2, sp, #4
 388:.././simpleserial/simpleserial.c **** 
 870              		.loc 1 388 9 view .LVU241
 871 009c 8DF80400 		strb	r0, [sp, #4]
 392:.././simpleserial/simpleserial.c **** #endif
 872              		.loc 1 392 2 is_stmt 1 view .LVU242
 873 00a0 0121     		movs	r1, #1
 874 00a2 7A20     		movs	r0, #122
 875 00a4 FFF7FEFF 		bl	simpleserial_put
 876              	.LVL73:
 877 00a8 B8E7     		b	.L47
 878              	.LVL74:
 879              	.L49:
 342:.././simpleserial/simpleserial.c **** 	{
 880              		.loc 1 342 35 discriminator 2 view .LVU243
 342:.././simpleserial/simpleserial.c **** 	{
 881              		.loc 1 342 38 is_stmt 0 discriminator 2 view .LVU244
 882 00aa 0133     		adds	r3, r3, #1
 883              	.LVL75:
 342:.././simpleserial/simpleserial.c **** 	{
 884              		.loc 1 342 38 discriminator 2 view .LVU245
 885 00ac B3E7     		b	.L48
 886              	.LVL76:
 887              	.L58:
 888              	.LBB18:
 367:.././simpleserial/simpleserial.c **** 
 889              		.loc 1 367 3 is_stmt 1 view .LVU246
 367:.././simpleserial/simpleserial.c **** 
 890              		.loc 1 367 7 is_stmt 0 view .LVU247
 891 00ae FFF7FEFF 		bl	getch
 892              	.LVL77:
 370:.././simpleserial/simpleserial.c **** 			return;
 893              		.loc 1 370 3 is_stmt 1 view .LVU248
 370:.././simpleserial/simpleserial.c **** 			return;
 894              		.loc 1 370 5 is_stmt 0 view .LVU249
 895 00b2 0A28     		cmp	r0, #10
 896 00b4 B2D0     		beq	.L47
 370:.././simpleserial/simpleserial.c **** 			return;
 897              		.loc 1 370 16 discriminator 1 view .LVU250
 898 00b6 0D28     		cmp	r0, #13
 899 00b8 B0D0     		beq	.L47
 373:.././simpleserial/simpleserial.c **** 	}
 900              		.loc 1 373 3 is_stmt 1 discriminator 2 view .LVU251
 373:.././simpleserial/simpleserial.c **** 	}
 901              		.loc 1 373 16 is_stmt 0 discriminator 2 view .LVU252
 902 00ba 07F8010B 		strb	r0, [r7], #1
 365:.././simpleserial/simpleserial.c **** 	{
 903              		.loc 1 365 42 is_stmt 1 discriminator 2 view .LVU253
 365:.././simpleserial/simpleserial.c **** 	{
 904              		.loc 1 365 43 is_stmt 0 discriminator 2 view .LVU254
 905 00be 0134     		adds	r4, r4, #1
 906              	.LVL78:
 365:.././simpleserial/simpleserial.c **** 	{
 907              		.loc 1 365 43 discriminator 2 view .LVU255
 908 00c0 D3E7     		b	.L57
 909              	.L71:
 910 00c2 00BF     		.align	2
 911              	.L70:
 912 00c4 00000000 		.word	.LANCHOR0
 913              	.LBE18:
 914              		.cfi_endproc
 915              	.LFE8:
 917              		.section	.rodata
 918              		.set	.LANCHOR1,. + 0
 921              	hex_lookup:
 922 0000 30313233 		.ascii	"0123456789ABCDEF"
 922      34353637 
 922      38394142 
 922      43444546 
 923              		.bss
 924              		.align	2
 925              		.set	.LANCHOR0,. + 0
 928              	num_commands:
 929 0000 00000000 		.space	4
 932              	commands:
 933 0004 00000000 		.space	256
 933      00000000 
 933      00000000 
 933      00000000 
 933      00000000 
 934              		.text
 935              	.Letext0:
 936              		.file 2 "c:\\users\\parth\\chipwh~1\\cw\\home\\portable\\armgcc\\arm-none-eabi\\include\\machine\\
 937              		.file 3 "c:\\users\\parth\\chipwh~1\\cw\\home\\portable\\armgcc\\arm-none-eabi\\include\\sys\\_std
 938              		.file 4 ".././hal/stm32f3/stm32f3_hal.h"
DEFINED SYMBOLS
                            *ABS*:00000000 simpleserial.c
C:\Users\parth\AppData\Local\Temp\cc29QJSh.s:16     .text.check_version:00000000 $t
C:\Users\parth\AppData\Local\Temp\cc29QJSh.s:24     .text.check_version:00000000 check_version
C:\Users\parth\AppData\Local\Temp\cc29QJSh.s:43     .text.ss_crc:00000000 $t
C:\Users\parth\AppData\Local\Temp\cc29QJSh.s:50     .text.ss_crc:00000000 ss_crc
C:\Users\parth\AppData\Local\Temp\cc29QJSh.s:115    .text.hex_decode:00000000 $t
C:\Users\parth\AppData\Local\Temp\cc29QJSh.s:122    .text.hex_decode:00000000 hex_decode
C:\Users\parth\AppData\Local\Temp\cc29QJSh.s:290    .text.simpleserial_addcmd_flags:00000000 $t
C:\Users\parth\AppData\Local\Temp\cc29QJSh.s:297    .text.simpleserial_addcmd_flags:00000000 simpleserial_addcmd_flags
C:\Users\parth\AppData\Local\Temp\cc29QJSh.s:356    .text.simpleserial_addcmd_flags:00000028 $d
C:\Users\parth\AppData\Local\Temp\cc29QJSh.s:361    .text.simpleserial_addcmd:00000000 $t
C:\Users\parth\AppData\Local\Temp\cc29QJSh.s:368    .text.simpleserial_addcmd:00000000 simpleserial_addcmd
C:\Users\parth\AppData\Local\Temp\cc29QJSh.s:386    .text.simpleserial_init:00000000 $t
C:\Users\parth\AppData\Local\Temp\cc29QJSh.s:393    .text.simpleserial_init:00000000 simpleserial_init
C:\Users\parth\AppData\Local\Temp\cc29QJSh.s:432    .text.simpleserial_init:00000020 $d
C:\Users\parth\AppData\Local\Temp\cc29QJSh.s:592    .text.ss_get_commands:00000000 ss_get_commands
C:\Users\parth\AppData\Local\Temp\cc29QJSh.s:540    .text.ss_num_commands:00000000 ss_num_commands
C:\Users\parth\AppData\Local\Temp\cc29QJSh.s:439    .text.simpleserial_put:00000000 $t
C:\Users\parth\AppData\Local\Temp\cc29QJSh.s:446    .text.simpleserial_put:00000000 simpleserial_put
C:\Users\parth\AppData\Local\Temp\cc29QJSh.s:527    .text.simpleserial_put:0000003c $d
C:\Users\parth\AppData\Local\Temp\cc29QJSh.s:533    .text.ss_num_commands:00000000 $t
C:\Users\parth\AppData\Local\Temp\cc29QJSh.s:580    .text.ss_num_commands:00000020 $d
C:\Users\parth\AppData\Local\Temp\cc29QJSh.s:585    .text.ss_get_commands:00000000 $t
C:\Users\parth\AppData\Local\Temp\cc29QJSh.s:690    .text.ss_get_commands:0000004c $d
C:\Users\parth\AppData\Local\Temp\cc29QJSh.s:696    .text.simpleserial_get:00000000 $t
C:\Users\parth\AppData\Local\Temp\cc29QJSh.s:703    .text.simpleserial_get:00000000 simpleserial_get
C:\Users\parth\AppData\Local\Temp\cc29QJSh.s:912    .text.simpleserial_get:000000c4 $d
C:\Users\parth\AppData\Local\Temp\cc29QJSh.s:921    .rodata:00000000 hex_lookup
C:\Users\parth\AppData\Local\Temp\cc29QJSh.s:924    .bss:00000000 $d
C:\Users\parth\AppData\Local\Temp\cc29QJSh.s:928    .bss:00000000 num_commands
C:\Users\parth\AppData\Local\Temp\cc29QJSh.s:932    .bss:00000004 commands

UNDEFINED SYMBOLS
putch
getch
